<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Directions and Distance</title>
    <link href="./map.css" rel="stylesheet"> 
  </head>

  <body class="">
    <div class="container">
      <h1 class="header">Agent Location</h1>
      <div id="distance" class="info hidden">
        <p id="price" class="info">N 300</p>
        <button id="orderButton" class="order-button">Order ride</button>
      </div>
      <div id="locationInput" class="input-container">
        <div class="input-group">
          <label for="destination" class="label"
            >Enter Your location:</label
          >
          <input
            type="text"
            id="destination"
            class="input"
            placeholder="E.g., No. 567 dakata, Nassarawa, Kano state, Nigeria"
          />
        </div>
        <button id="calculateButton" class="calculate-button">Enter</button>
      </div>

      <div id="map" class="map-container"></div>
    </div>

 

    <!-- Include the Google Maps JavaScript API -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDnJ9P3666KIhgb9fjstivsiTNbGM4zjMA&callback=initMap"
      async
      defer
    ></script>
    <script>8
      let markers = [];
      let locations = [
        {
          id: 1,
          title: "NSR",
          name: "Mr. john Doe",
          phone: "+23409123456",
          address: "No. 57, Ungogo, Kano State",
          latitude: 12.0001383,
          longitude: 8.5226245,
        },
        {
          id: 2,
          title: "MIJ",
          name: "Mrs. Mary Sue",
          phone: "+234912345690",
          address: "No. 57, Minjibir, Kano State",
          latitude: 12.17485215,
          longitude: 8.65940249296704,
        },
        {
          id: 4,
          title: "MJk",
          name: "Mr. Aliyu B.",
          phone: "+234091945680",
          address: "No. 87, bata, Nassarawa, Kano State",
          latitude: 12.0820585,
          longitude: 8.6911307617772,
        },
        {
          id: 6,
          title: "Musa",
          name: "Mr. Musa F.",
          phone: "+2340912345600",
          address: "No. 57, dakata, Nassarawa, Kano State",
          latitude: 12.08420585,
          longitude: 8.631911307772,
        },
        {
          id: 8,
          title: "Bayero",
          name: "Mr. Luis J.",
          phone: "+23409123456",
          address: "No. 57, dakata, Zoo road, Kano State",
          latitude: 12.08420585,
          longitude: 8.63819113074372,
        },
      ];
      
      const calculateButton = document.getElementById("calculateButton");
      const destinationInput = document.getElementById("destination");
      const locationInput = document.getElementById("locationInput");
      const distance = document.getElementById("distance");
      const orderButton = document.getElementById("orderButton");

      let map;
      let userMarker; // Declare userMarker at a higher scope

      function initMap() {
        const mapOptions = {
          zoom: 16,
        };

        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((position) => {
            const userLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            map = new google.maps.Map(document.getElementById("map"), {
              center: userLocation,
              ...mapOptions,
            });

            userMarker = new google.maps.Marker({
              position: userLocation,
              map: map,
              title: "My location",
              icon: {
                url: "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
                scaledSize: new google.maps.Size(60, 60),
              },
            });
          });

          calculateButton.addEventListener("click", () => {
            const destinationAddress = destinationInput.value;
            if (destinationAddress) {
              locationInput.classList.add("hidden");
              distance.classList.remove("hidden");
              markers.forEach((marker) => marker.setMap(null));
              markers = [];

              const geocoder = new google.maps.Geocoder();

              document.getElementById("distance").textContent =
                "Calculating...";

              geocoder.geocode(
                { address: destinationAddress },
                (results, status) => {
                  if (status === "OK" && results.length > 0) {
                    const destinationLocation = results[0].geometry.location;

                    const destinationMarker = new google.maps.Marker({
                      position: destinationLocation,
                      map: map,
                      title: "My Destination",
                      icon: {
                        url: "http://maps.google.com/mapfiles/ms/icons/green-dot.png",
                        scaledSize: new google.maps.Size(60, 60),
                      },
                    });
                    const userLoc = [userMarker.getPosition()];
                    const distance = 500;
                    document.getElementById(
                      "distance"
                    ).textContent = `Distance: ${distance} km`;
                  } else {
                    alert("Destination address not found.");
                  }
                }
              );
              // Create and add markers for locations
              locations.forEach((location) => {
                const marker = new google.maps.Marker({
                  position: { lat: location.latitude, lng: location.longitude },
                  map: map,
                  title: location.title,
                  icon: {
                    url: "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
                    scaledSize: new google.maps.Size(40, 40),
                  },
                });

                markers.push(marker);
              });

              // Fit map to display all markers
              const bounds = new google.maps.LatLngBounds();
              markers.forEach((marker) => bounds.extend(marker.getPosition()));
              map.fitBounds(bounds);
            } else {
              alert("Please enter a destination address.");
            }
          });
          orderButton.addEventListener("click", () => {
            distance.classList.add("hidden");
            alert("Rider is on his way");
          });
        } else {
          return alert("Geolocation is not supported by your browser.");
        }
      }
    </script>
  </body>
</html>
